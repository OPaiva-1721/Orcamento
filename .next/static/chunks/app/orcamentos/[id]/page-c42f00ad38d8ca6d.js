(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[898],{63:(e,a,t)=>{"use strict";var r=t(7260);t.o(r,"usePathname")&&t.d(a,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}})},1166:(e,a,t)=>{"use strict";t.d(a,{$:()=>i});var r=t(5155),s=t(2115),n=t(4269);let i=s.forwardRef((e,a)=>{let{className:t,variant:s="default",size:i="default",loading:o,children:l,disabled:d,asChild:c,...m}=e;return(0,r.jsxs)("button",{className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{default:"bg-blue-600 text-white hover:bg-blue-700",destructive:"bg-red-600 text-white hover:bg-red-700",outline:"border border-gray-300 bg-transparent hover:bg-gray-50 text-gray-900",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200",ghost:"hover:bg-gray-100 text-gray-900",link:"text-blue-600 underline-offset-4 hover:underline"}[s],{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}[i],t),ref:a,disabled:d||o,...m,children:[o&&(0,r.jsxs)("svg",{className:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),l]})});i.displayName="Button"},1647:(e,a,t)=>{"use strict";t.d(a,{W:()=>i});var r=t(5155);t(2115);var s=t(4269);function n(e){let{className:a,variant:t="default",...n}=e;return(0,r.jsx)("div",{className:(0,s.cn)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{default:"bg-blue-100 text-blue-800 border-blue-200",secondary:"bg-gray-100 text-gray-800 border-gray-200",destructive:"bg-red-100 text-red-800 border-red-200",outline:"border border-gray-300 text-gray-700",success:"bg-green-100 text-green-800 border-green-200",warning:"bg-yellow-100 text-yellow-800 border-yellow-200"}[t],a),...n})}function i(e){let{status:a}=e;return(0,r.jsx)(n,{variant:(e=>{switch(e.toLowerCase()){case"aprovado":case"conclu\xeddo":return"success";case"rejeitado":case"cancelado":return"destructive";case"pendente":return"warning";case"em andamento":return"default";default:return"secondary"}})(a),children:a})}},1847:(e,a,t)=>{"use strict";t.d(a,{A:()=>o});var r=t(2115);let s=function(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return a.filter((e,a,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===a).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,r.forwardRef)((e,a)=>{let{color:t="currentColor",size:i=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:d="",children:c,iconNode:m,...u}=e;return(0,r.createElement)("svg",{ref:a,...n,width:i,height:i,stroke:t,strokeWidth:l?24*Number(o)/Number(i):o,className:s("lucide",d),...u},[...m.map(e=>{let[a,t]=e;return(0,r.createElement)(a,t)}),...Array.isArray(c)?c:[c]])}),o=(e,a)=>{let t=(0,r.forwardRef)((t,n)=>{let{className:o,...l}=t;return(0,r.createElement)(i,{ref:n,iconNode:a,className:s("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),o),...l})});return t.displayName="".concat(e),t}},1895:(e,a,t)=>{Promise.resolve().then(t.bind(t,6091))},4269:(e,a,t)=>{"use strict";t.d(a,{Yq:()=>o,cn:()=>n,vv:()=>i});var r=t(2821),s=t(5889);function n(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,s.QP)((0,r.$)(a))}function i(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}function o(e){let a="string"==typeof e?new Date(e):e;return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}).format(a)}},5590:(e,a,t)=>{"use strict";t.d(a,{p:()=>i});var r=t(5155),s=t(2115),n=t(4269);let i=s.forwardRef((e,a)=>{let{className:t,type:i,label:o,error:l,helperText:d,id:c,...m}=e,u=c||s.useId();return(0,r.jsxs)("div",{className:"space-y-2",children:[o&&(0,r.jsx)("label",{htmlFor:u,className:"text-sm font-medium text-gray-700",children:o}),(0,r.jsx)("input",{type:i,className:(0,n.cn)("flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",l&&"border-red-500 focus-visible:ring-red-500",t),ref:a,id:u,...m}),l&&(0,r.jsx)("p",{className:"text-sm text-red-600",children:l}),d&&!l&&(0,r.jsx)("p",{className:"text-sm text-gray-500",children:d})]})});i.displayName="Input"},5626:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(1847).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6046:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(1847).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},6091:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>g});var r=t(5155),s=t(2115),n=t(63),i=t(1166),o=t(5590),l=t(7972),d=t(1647),c=t(5626),m=t(8085),u=t(9867),x=t(6046),h=t(2619),f=t.n(h),p=t(4269);function g(e){let{params:a}=e,t=(0,n.useRouter)(),h=(0,s.use)(a),[g,y]=(0,s.useState)(!1),[j,v]=(0,s.useState)(!1),[b,N]=(0,s.useState)(!1),[w,C]=(0,s.useState)(null),[k,E]=(0,s.useState)({descricao:"",preco:"",status:"Pendente",formaPagamento:!1,dataInicio:"",dataTermino:"",clienteId:"",destinatarioIds:[]});(0,s.useEffect)(()=>{I(h.id)},[h.id]);let I=async e=>{try{let a=await fetch("/api/orcamentos/".concat(e)),r=await a.json();r.success?(C(r.data),E({descricao:r.data.descricao,preco:r.data.preco.toString(),status:r.data.status,formaPagamento:r.data.formaPagamento,dataInicio:r.data.dataInicio?new Date(r.data.dataInicio).toISOString().split("T")[0]:"",dataTermino:r.data.dataTermino?new Date(r.data.dataTermino).toISOString().split("T")[0]:"",clienteId:r.data.clienteId.toString(),destinatarioIds:r.data.destinatarios.map(e=>e.id)})):(alert("Or\xe7amento n\xe3o encontrado"),t.push("/orcamentos"))}catch(e){console.error("Erro ao carregar or\xe7amento:",e),alert("Erro ao carregar or\xe7amento")}},R=async e=>{if(e.preventDefault(),"Conclu\xeddo"===k.status&&!k.dataTermino)return void alert('A data de t\xe9rmino \xe9 obrigat\xf3ria quando o status for "Conclu\xeddo"');y(!0);try{let e={...k,preco:parseFloat(k.preco),clienteId:parseInt(k.clienteId),dataTermino:k.dataTermino||null};console.log("Enviando dados:",e);let a=await fetch("/api/orcamentos/".concat(h.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await a.json();t.success?(alert("Or\xe7amento atualizado com sucesso!"),I(h.id)):alert("Erro ao atualizar or\xe7amento: ".concat(t.error))}catch(e){console.error("Erro ao atualizar or\xe7amento:",e),alert("Erro ao atualizar or\xe7amento")}finally{y(!1)}},A=e=>{let{name:a,value:t,type:r}=e.target;if("checkbox"===r){let t=e.target.checked;E({...k,[a]:t})}else E({...k,[a]:t})},S=async()=>{if(w&&w.destinatarios&&0!==w.destinatarios.length){v(!0);try{let e=await fetch("/api/enviar-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orcamentoId:w.id,destinatarioIds:w.destinatarios.map(e=>e.id)})}),a=await e.json();a.success?(alert("Email enviado com sucesso! ".concat(a.message)),I(h.id)):alert("Erro ao enviar email: ".concat(a.error))}catch(e){console.error("Erro ao enviar email:",e),alert("Erro ao enviar email")}finally{v(!1)}}},P=async()=>{if(w){N(!0);try{let e=await fetch("/api/gerar-pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orcamentoId:w.id})});if(e.ok){let a=await e.blob(),t=window.URL.createObjectURL(a),r=document.createElement("a");r.href=t,r.download="orcamento_".concat(w.id,".pdf"),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(t),document.body.removeChild(r)}else{let a=await e.json();alert("Erro ao gerar PDF: ".concat(a.error))}}catch(e){console.error("Erro ao gerar PDF:",e),alert("Erro ao gerar PDF")}finally{N(!1)}}};return w?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)(i.$,{variant:"outline",size:"sm",asChild:!0,children:(0,r.jsxs)(f(),{href:"/orcamentos",children:[(0,r.jsx)(c.A,{className:"mr-2 h-4 w-4"}),"Voltar"]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Editar Or\xe7amento"}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Or\xe7amento #",w.id," - ",w.descricao]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[w.destinatarios&&w.destinatarios.length>0&&(0,r.jsxs)(i.$,{variant:"outline",onClick:S,disabled:j,children:[(0,r.jsx)(m.A,{className:"mr-2 h-4 w-4"}),j?"Enviando...":"Enviar Email"]}),(0,r.jsxs)(i.$,{variant:"outline",onClick:P,disabled:b,children:[(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4"}),b?"Gerando...":"PDF"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsxs)(l.Zp,{children:[(0,r.jsxs)(l.aR,{children:[(0,r.jsx)(l.ZB,{children:"Informa\xe7\xf5es do Or\xe7amento"}),(0,r.jsx)(l.BT,{children:"Atualize os dados do or\xe7amento"})]}),(0,r.jsx)(l.Wu,{children:(0,r.jsxs)("form",{onSubmit:R,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)(o.p,{label:"Descri\xe7\xe3o",name:"descricao",value:k.descricao,onChange:A,placeholder:"Ex: Desenvolvimento de Sistema Web",required:!0}),(0,r.jsx)(o.p,{label:"Pre\xe7o",name:"preco",type:"number",step:"0.01",value:k.preco,onChange:A,placeholder:"15000.00",required:!0}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Status"}),(0,r.jsxs)("select",{name:"status",value:k.status,onChange:A,className:"flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2",children:[(0,r.jsx)("option",{value:"Pendente",children:"Pendente"}),(0,r.jsx)("option",{value:"Em Andamento",children:"Em Andamento"}),(0,r.jsx)("option",{value:"Aprovado",children:"Aprovado"}),(0,r.jsx)("option",{value:"Rejeitado",children:"Rejeitado"}),(0,r.jsx)("option",{value:"Cancelado",children:"Cancelado"}),(0,r.jsx)("option",{value:"Conclu\xeddo",children:"Conclu\xeddo"})]}),"Conclu\xeddo"===k.status&&(0,r.jsx)("p",{className:"text-xs text-green-600 mt-1",children:'ℹ️ Status "Conclu\xeddo" automaticamente marca como "Aprovado"'})]}),(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"formaPagamento",name:"formaPagamento",checked:k.formaPagamento,onChange:A,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"formaPagamento",className:"text-sm font-medium text-gray-700",children:"7 dias ap\xf3s o vencimento da nota"})]})}),(0,r.jsx)(o.p,{label:"Data de In\xedcio",name:"dataInicio",type:"date",value:k.dataInicio,onChange:A,required:!0}),(0,r.jsx)(o.p,{label:"Conclu\xeddo"===k.status?"Data de T\xe9rmino *":"Data de T\xe9rmino (Opcional)",name:"dataTermino",type:"date",value:k.dataTermino,onChange:A,required:"Conclu\xeddo"===k.status})]}),w.cliente.destinatarios&&w.cliente.destinatarios.length>0&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{children:(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Destinat\xe1rios do Or\xe7amento"})}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:w.cliente.destinatarios.map(e=>(0,r.jsxs)("div",{className:"flex items-center space-x-3 p-3 border rounded-lg",children:[(0,r.jsx)("input",{type:"checkbox",id:"destinatario-".concat(e.id),checked:k.destinatarioIds.includes(e.id),onChange:a=>{var t;return t=e.id,void(a.target.checked?E({...k,destinatarioIds:[...k.destinatarioIds,t]}):E({...k,destinatarioIds:k.destinatarioIds.filter(e=>e!==t)}))},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("label",{htmlFor:"destinatario-".concat(e.id),className:"text-sm font-medium text-gray-900 cursor-pointer",children:e.nome}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:e.email})]})]},e.id))})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)(i.$,{type:"button",variant:"outline",asChild:!0,children:(0,r.jsx)(f(),{href:"/orcamentos",children:"Cancelar"})}),(0,r.jsxs)(i.$,{type:"submit",loading:g,children:[(0,r.jsx)(x.A,{className:"mr-2 h-4 w-4"}),"Salvar Altera\xe7\xf5es"]})]})]})})]})}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(l.Zp,{children:[(0,r.jsx)(l.aR,{children:(0,r.jsx)(l.ZB,{children:"Cliente"})}),(0,r.jsx)(l.Wu,{children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:w.cliente.nome}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:w.cliente.email})]})})]}),(0,r.jsxs)(l.Zp,{children:[(0,r.jsx)(l.aR,{children:(0,r.jsx)(l.ZB,{children:"Resumo"})}),(0,r.jsxs)(l.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Valor:"}),(0,r.jsx)("span",{className:"font-semibold text-green-600",children:(0,p.vv)(w.preco)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Status:"}),(0,r.jsx)(d.W,{status:w.status})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Destinat\xe1rios:"}),(0,r.jsx)("span",{className:"font-medium",children:w.destinatarios?w.destinatarios.length:0})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Emails Enviados:"}),(0,r.jsx)("span",{className:"font-medium",children:w.emailsEnviados.length})]})]})]}),w.statusHistory&&w.statusHistory.length>0&&(0,r.jsxs)(l.Zp,{children:[(0,r.jsx)(l.aR,{children:(0,r.jsx)(l.ZB,{children:"Hist\xf3rico de Status"})}),(0,r.jsx)(l.Wu,{children:(0,r.jsx)("div",{className:"space-y-3",children:w.statusHistory.map(e=>(0,r.jsxs)("div",{className:"border-l-2 border-blue-200 pl-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(d.W,{status:e.status}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:(0,p.Yq)(e.dataMudanca)})]}),e.observacao&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.observacao})]},e.id))})})]})]})]})]}):(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Carregando or\xe7amento..."})]})})}},7972:(e,a,t)=>{"use strict";t.d(a,{BT:()=>d,Wu:()=>c,ZB:()=>l,Zp:()=>i,aR:()=>o});var r=t(5155),s=t(2115),n=t(4269);let i=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)("div",{ref:a,className:(0,n.cn)("rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm",t),...s})});i.displayName="Card";let o=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)("div",{ref:a,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...s})});o.displayName="CardHeader";let l=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)("h3",{ref:a,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...s})});l.displayName="CardTitle";let d=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)("p",{ref:a,className:(0,n.cn)("text-sm text-gray-500",t),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)("div",{ref:a,className:(0,n.cn)("p-6 pt-0",t),...s})});c.displayName="CardContent",s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)("div",{ref:a,className:(0,n.cn)("flex items-center p-6 pt-0",t),...s})}).displayName="CardFooter"},8085:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(1847).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},9867:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(1847).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])}},e=>{e.O(0,[909,619,441,255,358],()=>e(e.s=1895)),_N_E=e.O()}]);